---
// src/pages/lessons/[week].astro - Updated with sidebar TOC
import Layout from '../../layouts/Layout.astro';
import TableOfContents from '../../components/TableOfContents.astro';

export async function getStaticPaths() {
  const paths = [];
  for (let week = 1; week <= 60; week++) {
    paths.push({ params: { week: week.toString() } });
  }
  return paths;
}

const { week } = Astro.params;
const weekNumber = parseInt(week);

// Determine section
let sectionName = '';
if (weekNumber >= 1 && weekNumber <= 12) {
  sectionName = 'section1-html-css';
} else if (weekNumber >= 13 && weekNumber <= 24) {
  sectionName = 'section2-javascript';
} else if (weekNumber >= 25 && weekNumber <= 36) {
  sectionName = 'section3-backend';
} else if (weekNumber >= 37 && weekNumber <= 48) {
  sectionName = 'section4-react';
}

// For now, we'll use default TOC items
// Later you can fetch these from your markdown files or API
const tocItems = [
  { id: "learning-objectives", title: "Learning Objectives", level: 2 },
  { id: "day-1-introduction", title: "Day 1: Introduction", level: 2 },
  { id: "day-2-fundamentals", title: "Day 2: Fundamentals", level: 2 },
  { id: "day-3-practice", title: "Day 3: Practice", level: 2 },
  { id: "day-4-advanced", title: "Day 4: Advanced Topics", level: 2 },
  { id: "day-5-review", title: "Day 5: Review", level: 2 },
  { id: "assignments", title: "Assignments", level: 2 },
  { id: "resources", title: "Additional Resources", level: 2 }
];
---

<Layout title={`Week ${week} - Course Lesson`}>
  <main class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-8">
    <div class="max-w-7xl mx-auto px-4">
      
      <!-- Breadcrumb -->
      <nav class="mb-6">
        <ol class="flex items-center space-x-2 text-sm">
          <li><a href="/" class="text-indigo-600 hover:text-indigo-800">Home</a></li>
          <li class="text-gray-400">/</li>
          <li><a href="/lessons" class="text-indigo-600 hover:text-indigo-800">Lessons</a></li>
          <li class="text-gray-400">/</li>
          <li class="text-gray-600">Week {week}</li>
        </ol>
      </nav>

      <!-- Main Content Grid -->
      <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
        
        <!-- Sidebar - Table of Contents -->
        <aside class="lg:col-span-1 order-2 lg:order-1">
          <TableOfContents 
            weekNumber={weekNumber} 
            tocItems={tocItems}
            className="lg:sticky lg:top-4"
          />
          
          <!-- Week Navigation -->
          <div class="mt-6 bg-white rounded-lg shadow-sm border border-gray-200 p-4">
            <h4 class="font-semibold text-gray-900 mb-3">Navigate Weeks</h4>
            <div class="flex flex-col space-y-2">
              {weekNumber > 1 && (
                <a 
                  href={`/lessons/${weekNumber - 1}`}
                  class="flex items-center px-3 py-2 text-sm text-gray-600 hover:text-indigo-600 hover:bg-indigo-50 rounded-md transition-colors"
                >
                  <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                  </svg>
                  Week {weekNumber - 1}
                </a>
              )}
              
              <a 
                href="/lessons"
                class="flex items-center px-3 py-2 text-sm text-gray-600 hover:text-indigo-600 hover:bg-indigo-50 rounded-md transition-colors"
              >
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"></path>
                </svg>
                All Lessons
              </a>
              
              {weekNumber < 48 && (
                <a 
                  href={`/lessons/${weekNumber + 1}`}
                  class="flex items-center px-3 py-2 text-sm text-gray-600 hover:text-indigo-600 hover:bg-indigo-50 rounded-md transition-colors"
                >
                  Week {weekNumber + 1}
                  <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                  </svg>
                </a>
              )}
            </div>
          </div>
        </aside>

        <!-- Main Content Area -->
        <div class="lg:col-span-3 order-1 lg:order-2">
          
          <!-- Lesson Header -->
          <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <div class="flex items-center justify-between mb-4">
              <div>
                <h1 class="text-3xl font-bold text-gray-900 mb-2">
                  Week {week} Lesson
                </h1>
                <p class="text-gray-600">
                  {sectionName.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}
                </p>
              </div>
              
              <!-- Mobile TOC Toggle Button -->
              <button 
                id="mobile-toc-toggle"
                class="lg:hidden px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors"
              >
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"></path>
                </svg>
              </button>
            </div>
          </div>

          <!-- Lesson Content -->
          <div class="bg-white rounded-lg shadow-lg p-6">
            <!-- This is where your actual lesson content will go -->
            <!-- You can use your existing MarkdownRenderer component here -->
            
            <div class="prose max-w-none">
              <!-- Sample content structure that matches typical TOC -->
              
              <h2 id="learning-objectives">Learning Objectives</h2>
              <p>By the end of this week, you will be able to...</p>
              <ul>
                <li>Understand core concepts</li>
                <li>Apply practical skills</li>
                <li>Complete hands-on exercises</li>
              </ul>

              <h2 id="day-1-introduction">Day 1: Introduction</h2>
              <p>Today we'll start with the fundamentals...</p>

              <h2 id="day-2-fundamentals">Day 2: Fundamentals</h2>
              <p>Building on yesterday's introduction...</p>

              <h2 id="day-3-practice">Day 3: Practice</h2>
              <p>Time to put theory into practice...</p>

              <h2 id="day-4-advanced">Day 4: Advanced Topics</h2>
              <p>Now let's explore more advanced concepts...</p>

              <h2 id="day-5-review">Day 5: Review</h2>
              <p>Let's review everything we've learned...</p>

              <h2 id="assignments">Assignments</h2>
              <p>Complete the following assignments...</p>

              <h2 id="resources">Additional Resources</h2>
              <p>Here are some helpful resources for further learning...</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</Layout>

<script>
  // Mobile TOC toggle functionality
  document.addEventListener('DOMContentLoaded', function() {
    const toggleButton = document.getElementById('mobile-toc-toggle');
    const sidebar = document.querySelector('aside');
    
    if (toggleButton && sidebar) {
      toggleButton.addEventListener('click', function() {
        sidebar.classList.toggle('hidden');
        sidebar.classList.toggle('block');
      });
    }
  });
</script>

<style>
  /* Mobile TOC styles */
  @media (max-width: 1024px) {
    aside {
      @apply fixed top-0 left-0 z-50 w-80 h-full bg-white shadow-xl transform -translate-x-full transition-transform duration-300 p-6 overflow-y-auto;
    }
    
    aside.block {
      @apply translate-x-0;
    }
    
 
  }
</style>